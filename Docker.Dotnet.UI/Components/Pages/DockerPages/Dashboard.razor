@page "/dashboard"
@using Docker.Dotnet.UI.ViewModels
@attribute [Microsoft.AspNetCore.Authorization.Authorize]

@inherits MyComponentBase<DashboardViewModel>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="pa-4">
    <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween" Class="mb-4">
        <MudText Typo="Typo.h4">@Localizer["DASHBOARD"]</MudText>
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.Refresh"
                   OnClick="@(() => Vm!.LoadDashboardDataAsync())">
            @Localizer["REFRESH"]
        </MudButton>
    </MudStack>

    @if (Vm?.HasError == true)
    {
        <MudAlert Severity="Severity.Error" Class="mb-4" ShowCloseIcon="true"
                  CloseIconClicked="@(() => Vm!.ErrorMessage = null)">
            @Vm!.ErrorMessage
        </MudAlert>
    }

    @if (Vm?.SystemInfo != null)
    {
        <!-- Resource Overview Cards -->
        <MudGrid Class="mb-4">
            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="2" Style="height: 100%;">
                    <MudCardContent>
                        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                            <div>
                                <MudText Typo="Typo.body2"
                                         Color="Color.Secondary">@Localizer["DOCKER_CONTAINERS"]</MudText>
                                <MudText Typo="Typo.h4">@Vm!.TotalContainers</MudText>
                                <MudText Typo="Typo.caption">
                                    <MudIcon Icon="@Icons.Material.Filled.PlayArrow" Size="Size.Small"
                                             Color="Color.Success"/>
                                    @Vm!.RunningContainers @Localizer["RUNNING"]
                                </MudText>
                            </div>
                            <MudIcon Icon="@Icons.Material.Filled.Widgets" Size="Size.Large" Color="Color.Primary"/>
                        </MudStack>
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Href="/containers" Size="Size.Small">@Localizer["MORE"]</MudButton>
                    </MudCardActions>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="2" Style="height: 100%;">
                    <MudCardContent>
                        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                            <div>
                                <MudText Typo="Typo.body2" Color="Color.Secondary">@Localizer["DOCKER_IMAGES"]</MudText>
                                <MudText Typo="Typo.h4">@Vm!.TotalImages</MudText>
                                <MudText Typo="Typo.caption" Style="visibility: hidden;">-</MudText>
                            </div>
                            <MudIcon Icon="@Icons.Material.Filled.Image" Size="Size.Large" Color="Color.Info"/>
                        </MudStack>
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Href="/images" Size="Size.Small">@Localizer["MORE"]</MudButton>
                    </MudCardActions>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="2" Style="height: 100%;">
                    <MudCardContent>
                        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                            <div>
                                <MudText Typo="Typo.body2"
                                         Color="Color.Secondary">@Localizer["DOCKER_VOLUMES"]</MudText>
                                <MudText Typo="Typo.h4">@Vm!.TotalVolumes</MudText>
                                <MudText Typo="Typo.caption" Style="visibility: hidden;">-</MudText>
                            </div>
                            <MudIcon Icon="@Icons.Material.Filled.Storage" Size="Size.Large" Color="Color.Warning"/>
                        </MudStack>
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Href="/volumes" Size="Size.Small">@Localizer["MORE"]</MudButton>
                    </MudCardActions>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="2" Style="height: 100%;">
                    <MudCardContent>
                        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                            <div>
                                <MudText Typo="Typo.body2"
                                         Color="Color.Secondary">@Localizer["DOCKER_NETWORKS"]</MudText>
                                <MudText Typo="Typo.h4">@Vm!.TotalNetworks</MudText>
                                <MudText Typo="Typo.caption" Style="visibility: hidden;">-</MudText>
                            </div>
                            <MudIcon Icon="@Icons.Material.Filled.Hub" Size="Size.Large" Color="Color.Success"/>
                        </MudStack>
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Href="/networks" Size="Size.Small">@Localizer["MORE"]</MudButton>
                    </MudCardActions>
                </MudCard>
            </MudItem>
        </MudGrid>

        <!-- Container Status Breakdown -->
        <MudGrid Class="mb-4">
            <MudItem xs="12" md="6">
                <MudPaper Elevation="2" Class="pa-4">
                    <MudText Typo="Typo.h6" Class="mb-3">@Localizer["RESOURCE_USAGE"]</MudText>
                    <MudStack Spacing="2">
                        <div>
                            <MudStack Row="true" Justify="Justify.SpaceBetween">
                                <MudText Typo="Typo.body2">@Localizer["RUNNING"]</MudText>
                                <MudText Typo="Typo.body2">@Vm!.RunningContainers</MudText>
                            </MudStack>
                            <MudProgressLinear Color="Color.Success"
                                               Value="@GetPercentage(Vm!.RunningContainers, Vm!.TotalContainers)"
                                               Class="mt-1"/>
                        </div>
                        <div>
                            <MudStack Row="true" Justify="Justify.SpaceBetween">
                                <MudText Typo="Typo.body2">@Localizer["STOPPED"]</MudText>
                                <MudText Typo="Typo.body2">@Vm!.StoppedContainers</MudText>
                            </MudStack>
                            <MudProgressLinear Color="Color.Error"
                                               Value="@GetPercentage(Vm!.StoppedContainers, Vm!.TotalContainers)"
                                               Class="mt-1"/>
                        </div>
                        @if (Vm!.PausedContainers > 0)
                        {
                            <div>
                                <MudStack Row="true" Justify="Justify.SpaceBetween">
                                    <MudText Typo="Typo.body2">@Localizer["PAUSED"]</MudText>
                                    <MudText Typo="Typo.body2">@Vm!.PausedContainers</MudText>
                                </MudStack>
                                <MudProgressLinear Color="Color.Warning"
                                                   Value="@GetPercentage(Vm!.PausedContainers, Vm!.TotalContainers)"
                                                   Class="mt-1"/>
                            </div>
                        }
                    </MudStack>
                </MudPaper>
            </MudItem>

            <MudItem xs="12" md="6">
                <MudPaper Elevation="2" Class="pa-4">
                    <MudText Typo="Typo.h6" Class="mb-3">@Localizer["SYSTEM_INFO"]</MudText>
                    <MudStack Spacing="2">
                        <MudStack Row="true" Justify="Justify.SpaceBetween">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">@Localizer["DOCKER_VERSION"]</MudText>
                            <MudText Typo="Typo.body2">@Vm!.SystemInfo.ServerVersion</MudText>
                        </MudStack>
                        <MudStack Row="true" Justify="Justify.SpaceBetween">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">@Localizer["OS_TYPE"]</MudText>
                            <MudText Typo="Typo.body2">@Vm!.SystemInfo.OSType / @Vm!.SystemInfo.OperatingSystem</MudText>
                        </MudStack>
                        <MudStack Row="true" Justify="Justify.SpaceBetween">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">@Localizer["ARCHITECTURE"]</MudText>
                            <MudText Typo="Typo.body2">@Vm!.SystemInfo.Architecture</MudText>
                        </MudStack>
                        <MudStack Row="true" Justify="Justify.SpaceBetween">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">@Localizer["TOTAL_MEMORY"]</MudText>
                            <MudText Typo="Typo.body2">@Vm!.FormatBytes(Vm!.SystemInfo.MemTotal)</MudText>
                        </MudStack>
                        <MudStack Row="true" Justify="Justify.SpaceBetween">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">@Localizer["CPUS"]</MudText>
                            <MudText Typo="Typo.body2">@Vm!.SystemInfo.NCPU</MudText>
                        </MudStack>
                    </MudStack>
                </MudPaper>
            </MudItem>
        </MudGrid>
    }
</MudContainer>

@code {
    private double GetPercentage(int value, int total)
    {
        if (total == 0) return 0;
        return (double)value / total * 100;
    }
}
